# 简介

> yi-core 这个项目是独立环境的基础服务jar,提供路由的切换规则；


## 1.1 解决的问题

独立环境是个抽象的概念；

主要解决的问题：开发过程中，往往多个任务并行，并且一个项目可能由多人进行维护；

如果同时部署到QA环境，不仅会产生代码冲突、还有可能因为业务的关联性，导致与预想结果不符合；

注：核心解决的问题是这个，其他功能待补充。。。


## 1.2 实现的核心逻辑

核心实现思想：以需求创建项目代码分支，创建独立的需求测试环境，即将涉及此需求改动的项目部署到一个环境中，其他不变的项目使用公共QA;

实现前提：

1）服务部署时，携带对应的环境标识；

2）面向前端提供的服务，要有相应的api网关服务；

实现逻辑：

1）从客户端携带当前测试的环境编号（header 中添加相应的`环境变量`）；

2）网关（nginx）透传 ；

3）api网关根据环境变量选择 对应环境的api服务（没有走默认负载均衡策略）；

4）api服务在请求 微服务、mq等中间件是携带`环境变量`；



整体流程如下：

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f7a2c2b0b79441390c89e3617fe2621~tplv-k3u1fbpfcp-zoom-1.image)


